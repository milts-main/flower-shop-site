{% extends 'shop/base.html' %}

{% block content %}
<div class="container mt-5">
    <h2 class="mb-4">üì¶ –ú–æ–∏ –∑–∞–∫–∞–∑—ã</h2>

    {% if orders %}
        <div class="row row-cols-1 row-cols-md-2 g-4">
            {% for order in orders %}
                <div class="col">
                    <div class="card shadow-sm">
                        <div class="card-header bg-primary text-white">
                            –ó–∞–∫–∞–∑ ‚Ññ{{ order.id }} ‚Äî {{ order.date|date:"d.m.Y H:i" }}
                        </div>
                        <div class="card-body">
                            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> 
                                {% if order.status == 'cart' %}
                                    üõí –í –∫–æ—Ä–∑–∏–Ω–µ
                                {% elif order.status == 'placed' %}
                                    ‚è≥ –í –æ–±—Ä–∞–±–æ—Ç–∫–µ
                                {% elif order.status == 'delivered' %}
                                    ‚úÖ –î–æ—Å—Ç–∞–≤–ª–µ–Ω
                                {% endif %}
                            </p>
                            <p><strong>–ê–¥—Ä–µ—Å:</strong> {{ order.address }}</p>
                            <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ order.phone }}</p>
                            {% if order.comment %}
                                <p><strong>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</strong> {{ order.comment }}</p>
                            {% endif %}

                            <h5 class="mt-3">–¢–æ–≤–∞—Ä—ã:</h5>
                            <ul class="list-group list-group-flush mb-3">
                                {% for item in order.items.all %}
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        {{ item.flower.name }} ({{ item.quantity }} —à—Ç.)
                                        <span>{{ item.quantity }} x {{ item.price }} ‚ÇΩ</span>
                                    </li>
                                {% endfor %}
                            </ul>

                            <h5 class="text-end">–ò—Ç–æ–≥–æ: {{ order.total_cost }} ‚ÇΩ</h5>
                            {% if user.is_staff %}
                            <form method="post" action="{% url 'update_order_status' order.id %}" class="mt-3">
                                {% csrf_token %}

                                <select name="status" class="form-select mb-2">
                                    {% for key, value in order.STATUS_CHOICES %}
                                        <option value="{{ key }}" {% if order.status == key %}selected{% endif %}>
                                            {{ value }}
                                        </option>
                                    {% endfor %}
                                </select>

                                <button type="submit" class="btn btn-primary btn-sm">
                                    –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å
                                </button>
                            </form>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="alert alert-info">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤.</div>
    {% endif %}
</div>
{% endblock %}